<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promesas</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        background-color: #241b2f;
      }
    </style>
  </head>
  <body class="text-white">
    <div class="container d-flex justify-content-center mt-5">
      <button type="button" class="btn btn-outline-primary" onclick="getData()">
        Boton
      </button>
    </div>

    <form class="mb-3">
      <label for="title" class="form-label"
        >Titulo</label>
      <input class="form-control" type="text" name="title" id="title">
      <label for="exampleFormControlTextarea1" class="form-label"
        >Mensaje</label
      >
      <textarea
        class="form-control"
        id="exampleFormControlTextarea1"
        rows="3"
      ></textarea>

      <input class="btn bg-primary" type="submit" value="Enviar">
    </form>

    <section id="users-container" class="container"></section>

    <template id="user-card-template">
      <div class="card" style="width: 18rem">
        <div class="card-body">
          <h5 class="card-title">Card title</h5>
          <p class="card-text">
            Some quick example text to build on the card title and make up the
            bulk of the cardâ€™s content.
          </p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
      </div>
    </template>

    <template id="user-post-template">
      <div class="container">
        <h4>Titulo del post</h4>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ullam fuga a laboriosam necessitatibus rerum delectus illo voluptatibus nam quibusdam veritatis.</p>
      </div>
    </template>

    <script>
      function renderCards(users) {
        const usersContainer = document.getElementById('users-container');
        usersContainer.innerHTML = '';
        const temp = document.getElementById('user-card-template').content;

        const fragment = document.createDocumentFragment();

        users.forEach((user) => {
          const cardModel = temp.cloneNode(true);
          if (user.name)
            cardModel.querySelector('.card-title').innerText = user.name;
          fragment.appendChild(cardModel);
        });
        usersContainer.appendChild(fragment);
      }

      function getData() {
        fetch('https://jsonplaceholder.typicode.com/users')
          .then((res) => {
            if (res.ok) return res.json();
            else throw new Error(res.status);
          })
          .then((json) => {
            renderCards(json);
          })
          .catch((e) => {
            if (e.message == '404') console.error('404 - Not found');
            else console.error('Error: ' + e);
          })
          .finally(() => console.log('final'));
      }

      function writePost(title, body) {
        fetch('https://jsonplaceholder.typicode.com/posts', {
          method: 'POST',
          body: JSON.stringify({
            title: title,
            body: body,
            userId: 1,
          }),
          headers: {
            'Content-type': 'application/json; charset=UTF-8',
          },
        })
          .then((response) => response.json())
          .then((json) => renderNewMessage(json));
      }

      function renderNewMessage(msg) {
        // TODO: Completar esta funcion para mostrar los mensajes en pantalla
      }

      function handleSubmit(e) {

        const msgTitle = document.querySelector('#title').value
        const msgBody = document.querySelector('textarea').value

        writePost(msgTitle, msgBody)

      }

      document.querySelector('form').addEventListener('submit', handleSubmit)
    </script>
  </body>
</html>
